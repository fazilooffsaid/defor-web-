<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEFOR | Корзина</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .cart-container { max-width: 1200px; margin: 60px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 400px; gap: 40px; }
        .cart-items { background: white; padding: 30px; }
        .cart-item { display: flex; gap: 20px; padding: 20px 0; border-bottom: 1px solid #eee; }
        .cart-item img { width: 100px; height: 133px; object-fit: cover; cursor: pointer; }
        .item-details { flex: 1; }
        .item-name { font-size: 18px; font-weight: 600; margin-bottom: 5px; cursor: pointer; }
        .item-color { font-size: 14px; color: #666; margin-bottom: 10px; }
        .item-price { font-size: 18px; font-weight: 600; color: #4a90e2; }
        .qty-controls { display: flex; gap: 10px; align-items: center; margin-top: 15px; }
        .qty-btn { width: 30px; height: 30px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 16px; }
        .remove-btn { color: #e74c3c; text-decoration: underline; cursor: pointer; font-size: 13px; }
        .cart-summary { background: #1a2332; color: white; padding: 30px; position: sticky; top: 100px; height: fit-content; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 15px; }
        .summary-total { font-size: 22px; font-weight: 700; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3); }
        .btn-checkout { width: 100%; background: #4a90e2; color: white; border: none; padding: 16px; font-size: 13px; font-weight: 600; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; margin-top: 20px; }
        .btn-checkout:hover { background: #357abd; }
        @media (max-width: 1024px) { .cart-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo"><a href="index.html">DEFOR</a></div>
                <nav class="main-nav">
                    <a href="index.html" class="nav-link" data-i18n="nav-home">Главная</a>
                    <a href="new-arrivals.html" class="nav-link" data-i18n="nav-new">Новинки</a>
                    <a href="bags.html" class="nav-link" data-i18n="nav-bags">Сумки</a>
                    <a href="other.html" class="nav-link" data-i18n="nav-other">Другое</a>
                    <a href="accessories.html" class="nav-link" data-i18n="nav-accessories">Аксессуары</a>
                </nav>
                <div class="header-icons">
                    <div class="lang-selector">
                        <button class="lang-btn" data-lang="ru">RU</button>
                        <button class="lang-btn" data-lang="uz">UZ</button>
                        <button class="lang-btn" data-lang="en">EN</button>
                    </div>
                    <button class="icon-btn cart-btn" onclick="window.location.href='cart.html'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <path d="M16 10a4 4 0 0 1-8 0"></path>
                        </svg>
                        <span class="cart-count" id="cart-count">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="cart-container">
        <div class="cart-items">
            <h1 class="cart-page-title" style="font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 400; margin-bottom: 30px;">Ваша корзина</h1>
            <div id="cart-items-list"></div>
        </div>
        <div class="cart-summary">
            <h2 class="cart-summary-title" style="font-size: 20px; margin-bottom: 20px;">Итого</h2>
            <div class="summary-row">
                <span class="subtotal-label">Промежуточный итог:</span>
                <span id="subtotal">0 UZS</span>
            </div>
            <div class="summary-row summary-total">
                <span class="total-label">Итого:</span>
                <span id="total">0 UZS</span>
            </div>
            <button class="btn-checkout" onclick="checkout()">ОФОРМИТЬ ЗАКАЗ</button>
        </div>
    </div>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2026 DEFOR. <span data-i18n="footer-rights">Все права защищены</span></p>
            </div>
        </div>
    </footer>

    <style>
    .telegram-chat-widget { position: fixed; bottom: 30px; left: 30px; z-index: 9999; }
    .telegram-chat-button { width: 60px; height: 60px; background: linear-gradient(135deg, #0088cc, #00a6e8); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(0,136,204,0.4); text-decoration: none; transition: all 0.3s; }
    .telegram-chat-button:hover { transform: scale(1.1); }
    .telegram-chat-button svg { width: 32px; height: 32px; fill: white; }
    </style>
    <div class="telegram-chat-widget">
        <a href="https://t.me/faz1llooffss" target="_blank" class="telegram-chat-button">
            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg>
        </a>
    </div>

    <script src="database.js"></script>
    <script src="app.js"></script>
    <script>
        function renderCart() {
            const cart = getCart();
            const container = document.getElementById('cart-items-list');
            const lang = getLang ? getLang() : (localStorage.getItem('defor_lang') || 'ru');
            const colorLabel = { ru: 'Цвет', uz: 'Rang', en: 'Color' };
            const emptyLabel = { ru: 'Корзина пуста.', uz: "Savatcha bo'sh.", en: 'Cart is empty.' };
            const removeLabel = { ru: 'Удалить', uz: "O'chirish", en: 'Remove' };

            if (cart.length === 0) {
                container.innerHTML = `<p style="text-align:center;padding:60px;color:#999;">${emptyLabel[lang]}</p>`;
                document.getElementById('subtotal').textContent = '0 UZS';
                document.getElementById('total').textContent = '0 UZS';
                return;
            }

            container.innerHTML = cart.map((item, index) => {
                const image = item.images && item.images[0] ? item.images[0] : '';
                const color = item.selectedColor || (item.colors && item.colors[0] ? item.colors[0].name : '-');
                return `
                <div class="cart-item">
                    <img src="${image}" alt="${item.title}" onclick="window.location.href='product.html?id=${item.id}'">
                    <div class="item-details">
                        <div class="item-name" onclick="window.location.href='product.html?id=${item.id}'">${item.title}</div>
                        <div class="item-color">${colorLabel[lang]}: ${color}</div>
                        <div class="item-price">${Number(item.price).toLocaleString('ru-RU')} UZS</div>
                        <div class="qty-controls">
                            <button class="qty-btn" onclick="updateQty(${index}, -1)">-</button>
                            <span style="min-width:30px;text-align:center;">${item.quantity}</span>
                            <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
                            <span class="remove-btn" onclick="removeItem(${index})">${removeLabel[lang]}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');

            const total = getCartTotal();
            document.getElementById('subtotal').textContent = total.toLocaleString('ru-RU') + ' UZS';
            document.getElementById('total').textContent = total.toLocaleString('ru-RU') + ' UZS';
        }

        function updateQty(index, change) {
            const cart = getCart();
            cart[index].quantity = Math.max(1, cart[index].quantity + change);
            saveCart(cart);
            renderCart();
            updateCartCount();
        }

        function removeItem(index) {
            const cart = getCart();
            cart.splice(index, 1);
            saveCart(cart);
            renderCart();
            updateCartCount();
        }

        function checkout() {
            const lang = getLang ? getLang() : 'ru';
            const emptyMsg = { ru: 'Корзина пуста!', uz: "Savatcha bo'sh!", en: 'Cart is empty!' };
            if (getCart().length === 0) { alert(emptyMsg[lang]); return; }
            window.location.href = 'checkout.html';
        }

        renderCart();
        updateCartCount();
    </script>
    <script src="lang-switcher.js"></script>
</body>
</html>