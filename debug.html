<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug - DEFOR</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .section { background: white; padding: 20px; margin: 20px 0; border-radius: 5px; }
        h2 { color: #333; }
        pre { background: #f9f9f9; padding: 10px; overflow-x: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .ok { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç DEFOR Debug Page</h1>
    
    <div class="section">
        <h2>üìä LocalStorage Status</h2>
        <div id="storage-status"></div>
    </div>
    
    <div class="section">
        <h2>üì¶ Products Data (defor_db)</h2>
        <div id="products-data"></div>
    </div>
    
    <div class="section">
        <h2>üõí Cart Data (defor_cart)</h2>
        <div id="cart-data"></div>
    </div>
    
    <div class="section">
        <h2>üåç Language (defor_lang)</h2>
        <div id="lang-data"></div>
    </div>
    
    <div class="section">
        <h2>üß™ Quick Actions</h2>
        <button onclick="addTestProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä</button>
        <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
    </div>
    
    <script>
        function checkStorage() {
            const statusDiv = document.getElementById('storage-status');
            const productsDiv = document.getElementById('products-data');
            const cartDiv = document.getElementById('cart-data');
            const langDiv = document.getElementById('lang-data');
            
            // Check if localStorage is available
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                statusDiv.innerHTML = '<div class="status ok">‚úÖ localStorage –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
            } catch (e) {
                statusDiv.innerHTML = '<div class="status error">‚ùå localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + e.message + '</div>';
                return;
            }
            
            // Check products
            const productsRaw = localStorage.getItem('defor_db');
            if (!productsRaw) {
                productsDiv.innerHTML = '<div class="status error">‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (defor_db –ø—É—Å—Ç)</div>';
            } else {
                try {
                    const products = JSON.parse(productsRaw);
                    productsDiv.innerHTML = `
                        <div class="status ok">‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${products.length}</div>
                        <pre>${JSON.stringify(products, null, 2)}</pre>
                    `;
                } catch (e) {
                    productsDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö: ' + e.message + '</div>';
                }
            }
            
            // Check cart
            const cartRaw = localStorage.getItem('defor_cart');
            if (!cartRaw) {
                cartDiv.innerHTML = '<div class="status ok">‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
            } else {
                try {
                    const cart = JSON.parse(cartRaw);
                    cartDiv.innerHTML = `
                        <div class="status ok">‚úÖ –í –∫–æ—Ä–∑–∏–Ω–µ: ${cart.length} —Ç–æ–≤–∞—Ä–æ–≤</div>
                        <pre>${JSON.stringify(cart, null, 2)}</pre>
                    `;
                } catch (e) {
                    cartDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ—Ä–∑–∏–Ω—ã: ' + e.message + '</div>';
                }
            }
            
            // Check language
            const lang = localStorage.getItem('defor_lang') || 'ru';
            langDiv.innerHTML = `<div class="status ok">‚úÖ –¢–µ–∫—É—â–∏–π —è–∑—ã–∫: ${lang}</div>`;
        }
        
        function addTestProduct() {
            const testProduct = {
                id: 'PROD-TEST-' + Date.now(),
                title: '–¢–µ—Å—Ç–æ–≤–∞—è —Å—É–º–∫–∞ DEFOR',
                price: 1500000,
                category: 'bags',
                isNew: true,
                description: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞',
                variants: [
                    {
                        colorName: '–ß–µ—Ä–Ω—ã–π',
                        colorHex: '#000000',
                        inStock: true,
                        images: [
                            'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="500"><rect fill="%23000" width="400" height="500"/><text x="50%" y="50%" fill="white" text-anchor="middle" font-size="24">TEST PRODUCT</text></svg>'
                        ]
                    }
                ]
            };
            
            const existing = localStorage.getItem('defor_db');
            const products = existing ? JSON.parse(existing) : [];
            products.push(testProduct);
            localStorage.setItem('defor_db', JSON.stringify(products));
            
            alert('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
            checkStorage();
        }
        
        function clearAll() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ!')) {
                localStorage.clear();
                alert('üóë –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
                checkStorage();
            }
        }
        
        // Run check on load
        checkStorage();
    </script>
</body>
</html>