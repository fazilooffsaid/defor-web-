// ============================================
// DEFOR Language Switcher - единственный файл перевода
// Ключи используют ДЕФИС (nav-home)
// ============================================

const translations = {
    ru: {
        'nav-home': 'Главная', 'nav-new': 'Новинки', 'nav-bags': 'Сумки',
        'nav-other': 'Другое', 'nav-accessories': 'Аксессуары',
        'hero-title': 'DEFOR',
        'hero-subtitle': 'Эксклюзивная коллекция премиальных аксессуаров',
        'hero-btn': 'ВОЙТИ В КРУГ ИЗБРАННЫХ',
        'categories-title': 'Категории',
        'cat-new': 'Новинки', 'cat-bags': 'Сумки', 'cat-other': 'Другое', 'cat-accessories': 'Аксессуары',
        'collection-title': 'Наша коллекция',
        'page-new-title': 'Новые поступления',
        'page-new-desc': 'Узнайте о продуктах, совместных проектах и цветовых решениях, которые только что появились.',
        'page-new-breadcrumb': 'Новинки', 'page-new-coming': 'Новинки скоро появятся',
        'page-new-items': 'предметов', 'page-new-badge': 'Новые поступления',
        'page-bags-title': 'Сумки', 'page-bags-breadcrumb': 'Сумки', 'page-bags-coming': 'Товары скоро появятся',
        'page-other-title': 'Другое', 'page-other-coming': 'Товары скоро появятся',
        'page-acc-title': 'Аксессуары', 'page-acc-coming': 'Товары скоро появятся',
        'product-new': 'НОВЫЕ ПОСТУПЛЕНИЯ', 'product-instock': 'В наличии',
        'product-outofstock': 'Нет в наличии', 'product-addtobag': 'ДОБАВИТЬ В СУМКУ',
        'product-description': 'ОПИСАНИЕ', 'product-color': 'Цвет',
        'product-notfound': 'Товар не найден', 'product-loading': 'Загрузка...',
        'cart-title': 'Ваша корзина', 'cart-empty': 'Корзина пуста.',
        'cart-color': 'Цвет', 'cart-subtotal': 'Промежуточный итог:',
        'cart-total': 'Итого:', 'cart-checkout-btn': 'ОФОРМИТЬ ЗАКАЗ',
        'cart-remove': 'Удалить', 'cart-summary-title': 'Итого',
        'checkout-title': 'Оформление заказа', 'checkout-your-items': 'Ваши товары',
        'checkout-contacts': 'Контактные данные', 'checkout-name-label': 'ВАШЕ ИМЯ',
        'checkout-name-placeholder': 'Введите ваше имя', 'checkout-city-label': 'ГОРОД',
        'checkout-city-placeholder': 'Введите ваш город', 'checkout-phone-label': 'НОМЕР ТЕЛЕФОНА',
        'checkout-color': 'Цвет', 'checkout-qty': 'Количество',
        'checkout-subtotal': 'Промежуточный итог:', 'checkout-total': 'Итого:',
        'checkout-submit': 'ПОДТВЕРДИТЬ ЗАКАЗ', 'checkout-success-title': 'ЗАКАЗ ПОДТВЕРЖДЕН!',
        'checkout-success-msg': 'Мы с вами свяжемся', 'checkout-continue': 'Продолжить покупки',
        'toast-added': 'Товар добавлен в корзину!',
        'footer-desc': 'Премиальные аксессуары для современного стиля',
        'footer-company': 'Компания', 'footer-about': 'О нас', 'footer-contact': 'Контакты',
        'footer-support': 'Поддержка', 'footer-social': 'Связь', 'footer-rights': 'Все права защищены',
        'footer-admin': 'Админ-панель', 'footer-help': 'Помощь',
        'footer-shipping': 'Доставка', 'footer-returns': 'Возврат', 'footer-faq': 'FAQ',
        'featured-title': 'Избранные товары', 'view-all': 'Смотреть все →',
        'new-arrivals-badge': 'Новые поступления', 'in-stock': 'В наличии',
        'add-to-bag': 'Добавить в сумку'
    },
    uz: {
        'nav-home': 'Bosh sahifa', 'nav-new': 'Yangiliklar', 'nav-bags': 'Sumkalar',
        'nav-other': 'Boshqa', 'nav-accessories': 'Aksessuarlar',
        'hero-title': 'DEFOR',
        'hero-subtitle': 'Premium aksessuarlarning eksklyuziv kolleksiyasi',
        'hero-btn': 'XARID QILISH',
        'categories-title': 'Kategoriyalar',
        'cat-new': 'Yangiliklar', 'cat-bags': 'Sumkalar', 'cat-other': 'Boshqa', 'cat-accessories': 'Aksessuarlar',
        'collection-title': 'Bizning kolleksiya',
        'page-new-title': 'Yangi kelganlar',
        'page-new-desc': 'Yangi mahsulotlar, hamkorlik loyihalari va rang yechimlari haqida bilib oling.',
        'page-new-breadcrumb': 'Yangiliklar', 'page-new-coming': "Yangiliklar tez orada paydo bo'ladi",
        'page-new-items': 'mahsulot', 'page-new-badge': 'Yangi kelganlar',
        'page-bags-title': 'Sumkalar', 'page-bags-breadcrumb': 'Sumkalar', 'page-bags-coming': "Mahsulotlar tez orada paydo bo'ladi",
        'page-other-title': 'Boshqa', 'page-other-coming': "Mahsulotlar tez orada paydo bo'ladi",
        'page-acc-title': 'Aksessuarlar', 'page-acc-coming': "Mahsulotlar tez orada paydo bo'ladi",
        'product-new': 'YANGI KELGANLAR', 'product-instock': 'Mavjud',
        'product-outofstock': 'Mavjud emas', 'product-addtobag': "SAVATCHAGA QO'SHISH",
        'product-description': 'TAVSIF', 'product-color': 'Rang',
        'product-notfound': 'Mahsulot topilmadi', 'product-loading': 'Yuklanmoqda...',
        'cart-title': 'Sizning savatingiz', 'cart-empty': "Savatcha bo'sh.",
        'cart-color': 'Rang', 'cart-subtotal': 'Oraliq jami:',
        'cart-total': 'Jami:', 'cart-checkout-btn': 'BUYURTMA BERISH',
        'cart-remove': "O'chirish", 'cart-summary-title': 'Jami',
        'checkout-title': 'Buyurtmani rasmiylashtirish', 'checkout-your-items': 'Sizning mahsulotlaringiz',
        'checkout-contacts': "Aloqa ma'lumotlari", 'checkout-name-label': 'ISMINGIZ',
        'checkout-name-placeholder': 'Ismingizni kiriting', 'checkout-city-label': 'SHAHAR',
        'checkout-city-placeholder': 'Shahringizni kiriting', 'checkout-phone-label': 'TELEFON RAQAMI',
        'checkout-color': 'Rang', 'checkout-qty': 'Miqdor',
        'checkout-subtotal': 'Oraliq jami:', 'checkout-total': 'Jami:',
        'checkout-submit': 'BUYURTMANI TASDIQLASH', 'checkout-success-title': 'BUYURTMA TASDIQLANDI!',
        'checkout-success-msg': 'Biz siz bilan bog\'lanamiz', 'checkout-continue': 'Xarid davom ettirish',
        'toast-added': "Mahsulot savatchaga qo'shildi!",
        'footer-desc': 'Zamonaviy uslub uchun premium aksessuarlar',
        'footer-company': 'Kompaniya', 'footer-about': 'Biz haqimizda', 'footer-contact': 'Aloqa',
        'footer-support': 'Yordam', 'footer-social': "Bog'lanish", 'footer-rights': 'Barcha huquqlar himoyalangan',
        'footer-admin': 'Admin panel', 'footer-help': 'Yordam',
        'footer-shipping': 'Yetkazib berish', 'footer-returns': 'Qaytarish', 'footer-faq': 'Savol-javob',
        'featured-title': 'Tanlangan mahsulotlar', 'view-all': "Hammasini ko'rish →",
        'new-arrivals-badge': 'Yangi kelganlar', 'in-stock': 'Mavjud',
        'add-to-bag': "Savatga qo'shish"
    },
    en: {
        'nav-home': 'Home', 'nav-new': 'New Arrivals', 'nav-bags': 'Bags',
        'nav-other': 'Other', 'nav-accessories': 'Accessories',
        'hero-title': "DEFOR",
        'hero-subtitle': 'Exclusive collection of premium accessories',
        'hero-btn': 'SHOP NOW',
        'categories-title': 'Categories',
        'cat-new': 'New Arrivals', 'cat-bags': 'Bags', 'cat-other': 'Other', 'cat-accessories': 'Accessories',
        'collection-title': 'Our Collection',
        'page-new-title': 'New Arrivals',
        'page-new-desc': 'Discover products, collaborations and color solutions that have just arrived.',
        'page-new-breadcrumb': 'New Arrivals', 'page-new-coming': 'New arrivals coming soon',
        'page-new-items': 'items', 'page-new-badge': 'New Arrival',
        'page-bags-title': 'Bags', 'page-bags-breadcrumb': 'Bags', 'page-bags-coming': 'Products coming soon',
        'page-other-title': 'Other', 'page-other-coming': 'Products coming soon',
        'page-acc-title': 'Accessories', 'page-acc-coming': 'Products coming soon',
        'product-new': 'NEW ARRIVAL', 'product-instock': 'In stock',
        'product-outofstock': 'Out of stock', 'product-addtobag': 'ADD TO BAG',
        'product-description': 'DESCRIPTION', 'product-color': 'Colour',
        'product-notfound': 'Product not found', 'product-loading': 'Loading...',
        'cart-title': 'Your Cart', 'cart-empty': 'Cart is empty.',
        'cart-color': 'Color', 'cart-subtotal': 'Subtotal:',
        'cart-total': 'Total:', 'cart-checkout-btn': 'CHECKOUT',
        'cart-remove': 'Remove', 'cart-summary-title': 'Total',
        'checkout-title': 'Checkout', 'checkout-your-items': 'Your Items',
        'checkout-contacts': 'Contact Details', 'checkout-name-label': 'YOUR NAME',
        'checkout-name-placeholder': 'Enter your name', 'checkout-city-label': 'CITY',
        'checkout-city-placeholder': 'Enter your city', 'checkout-phone-label': 'PHONE NUMBER',
        'checkout-color': 'Color', 'checkout-qty': 'Quantity',
        'checkout-subtotal': 'Subtotal:', 'checkout-total': 'Total:',
        'checkout-submit': 'CONFIRM ORDER', 'checkout-success-title': 'ORDER CONFIRMED!',
        'checkout-success-msg': 'We will contact you', 'checkout-continue': 'Continue Shopping',
        'toast-added': 'Item added to bag!',
        'footer-desc': 'Premium accessories for modern lifestyle',
        'footer-company': 'Company', 'footer-about': 'About Us', 'footer-contact': 'Contact',
        'footer-support': 'Support', 'footer-social': 'Social', 'footer-rights': 'All rights reserved',
        'footer-admin': 'Admin Panel', 'footer-help': 'Help',
        'footer-shipping': 'Shipping', 'footer-returns': 'Returns', 'footer-faq': 'FAQ',
        'featured-title': 'Featured Products', 'view-all': 'View All →',
        'new-arrivals-badge': 'New Arrival', 'in-stock': 'In Stock',
        'add-to-bag': 'Add to Bag'
    }
};

function getLang() {
    return localStorage.getItem('defor_lang') || 'ru';
}

function t(key) {
    const lang = getLang();
    return (translations[lang] && translations[lang][key]) || (translations.ru[key]) || key;
}

function updateLanguage(lang) {
    if (!translations[lang]) return;
    localStorage.setItem('defor_lang', lang);

    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const val = translations[lang][key];
        if (!val) return;
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = val;
        } else {
            el.textContent = val;
        }
    });

    document.querySelectorAll('[data-i18n-ph]').forEach(el => {
        const key = el.getAttribute('data-i18n-ph');
        const val = translations[lang][key];
        if (val) el.placeholder = val;
    });

    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });

    updateDynamic(lang);
}

function updateDynamic(lang) {
    const tr = translations[lang];

    // Product page dynamic elements
    const addBtn = document.querySelector('.add-button');
    if (addBtn) addBtn.textContent = tr['product-addtobag'];

    const stockText = document.querySelector('.stock-text');
    if (stockText) stockText.textContent = tr['product-instock'];

    const badge = document.querySelector('.badge');
    if (badge) badge.textContent = tr['product-new'];

    document.querySelectorAll('.desc-label').forEach(el => { el.textContent = tr['product-description']; });
    document.querySelectorAll('.product-badge').forEach(el => { el.textContent = tr['page-new-badge']; });

    // Toast
    const toastTitle = document.querySelector('.toast-title');
    if (toastTitle) toastTitle.textContent = tr['toast-added'];

    // Cart page
    const cartTitle = document.querySelector('.cart-page-title');
    if (cartTitle) cartTitle.textContent = tr['cart-title'];
    const cartSumTitle = document.querySelector('.cart-summary-title');
    if (cartSumTitle) cartSumTitle.textContent = tr['cart-summary-title'];
    const checkoutBtn = document.querySelector('.btn-checkout');
    if (checkoutBtn) checkoutBtn.textContent = tr['cart-checkout-btn'];
    const subtotalLabel = document.querySelector('.subtotal-label');
    if (subtotalLabel) subtotalLabel.textContent = tr['cart-subtotal'];
    const totalLabel = document.querySelector('.total-label');
    if (totalLabel) totalLabel.textContent = tr['cart-total'];

    // Checkout
    const checkoutTitle = document.querySelector('.checkout-title');
    if (checkoutTitle) checkoutTitle.textContent = tr['checkout-title'];
    const submitBtn = document.getElementById('submitOrderBtn');
    if (submitBtn) submitBtn.textContent = tr['checkout-submit'];
    const successTitle = document.querySelector('.success-title');
    if (successTitle) successTitle.textContent = tr['checkout-success-title'];
    const successMsg = document.querySelector('.success-message');
    if (successMsg) successMsg.textContent = tr['checkout-success-msg'];
    const continueBtn = document.querySelector('.btn-close-modal');
    if (continueBtn) continueBtn.textContent = tr['checkout-continue'];

    // Re-render dynamic pages
    if (typeof renderCart === 'function') renderCart();
    if (typeof renderOrderSummary === 'function') renderOrderSummary();
    if (typeof render === 'function') render();
}

function initLang() {
    const lang = getLang();
    updateLanguage(lang);
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => updateLanguage(btn.dataset.lang));
    });
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => setTimeout(initLang, 100));
} else {
    setTimeout(initLang, 100);
}

window.updateLanguage = updateLanguage;
window.t = t;
window.getLang = getLang;