<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEFOR | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: #1a2332; color: white; padding: 30px; text-align: center; margin-bottom: 30px; }
        .header h1 { font-family: 'Playfair Display', serif; font-size: 36px; letter-spacing: 4px; margin-bottom: 10px; }
        .card { background: white; padding: 30px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #4a90e2; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; font-size: 13px; margin-bottom: 8px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; font-size: 14px; font-family: 'Inter', sans-serif; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #4a90e2; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { padding: 14px 30px; border: none; font-size: 13px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #4a90e2; color: white; width: 100%; }
        .btn-primary:hover { background: #357abd; }
        .btn-primary:disabled { background: #aaa; cursor: not-allowed; }
        .btn-danger { background: #e74c3c; color: white; padding: 10px 20px; font-size: 11px; }
        .color-variant { margin-bottom: 20px; padding: 20px; border: 2px solid #eee; border-radius: 8px; }
        .color-variant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .color-variant-title { font-weight: 600; font-size: 15px; }
        .remove-color-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .photo-queue { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 15px; }
        .queue-item { position: relative; aspect-ratio: 3/4; background: #f5f5f5; border: 1px solid #ddd; overflow: hidden; }
        .queue-item img { width: 100%; height: 100%; object-fit: cover; }
        .remove-btn { position: absolute; top: 5px; right: 5px; background: #e74c3c; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; font-size: 16px; }
        .add-color-btn { background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; margin-top: 10px; }
        .add-color-btn:hover { background: #229954; }
        .product-list { margin-top: 20px; }
        .product-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; }
        .product-item img { width: 60px; height: 80px; object-fit: cover; margin-right: 15px; }
        .product-details { flex: 1; }
        .product-name { font-weight: 600; margin-bottom: 5px; }
        .product-meta { font-size: 12px; color: #666; }
        .nav-links { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .nav-links a { color: #4a90e2; text-decoration: none; font-weight: 500; }
        .checkbox-label { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .checkbox-label input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }

        /* Showcase */
        .showcase-slots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .showcase-slot { border: 2px dashed #ddd; border-radius: 8px; overflow: hidden; aspect-ratio: 1; position: relative; background: #f9f9f9; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: border-color 0.3s; }
        .showcase-slot:hover { border-color: #4a90e2; }
        .showcase-slot img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        .showcase-slot .slot-label { font-size: 13px; color: #999; text-align: center; padding: 10px; z-index: 1; }
        .showcase-slot .slot-num { font-size: 32px; color: #ddd; font-weight: 700; }
        .showcase-slot .slot-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.5); display: flex; gap: 8px; padding: 8px; justify-content: center; opacity: 0; transition: opacity 0.3s; z-index: 2; }
        .showcase-slot:hover .slot-overlay { opacity: 1; }
        .slot-overlay button { background: white; border: none; border-radius: 4px; padding: 5px 10px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .slot-overlay .del-btn { background: #e74c3c; color: white; }
        .showcase-save-btn { background: #27ae60; color: white; border: none; padding: 14px 30px; font-size: 13px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; width: 100%; margin-top: 20px; border-radius: 4px; }
        .showcase-save-btn:hover { background: #229954; }
        .slot-hint { font-size: 12px; color: #aaa; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DEFOR</h1>
            <p>–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</p>
        </div>

        <div class="nav-links">
            <a href="index.html">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>
        </div>

        <!-- 1. –ë–∞–Ω–Ω–µ—Ä -->
        <div class="card">
            <h2 class="card-title">1. –ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</h2>
            <div class="form-group">
                <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞</label>
                <input type="file" accept="image/*" onchange="updateHero(this)">
            </div>
            <button class="btn-danger" onclick="clearHero()">–£–¥–∞–ª–∏—Ç—å –±–∞–Ω–Ω–µ—Ä</button>
        </div>

        <!-- 2. –§–æ—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ -->
        <div class="card">
            <h2 class="card-title">2. –§–æ—Ç–æ —Ä–∞–∑–¥–µ–ª–∞ ¬´–ù–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è¬ª</h2>
            <p style="color:#666; font-size:14px; margin-bottom:20px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è —Ç—Ä—ë—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —Ñ–æ—Ç–æ, –º–∏–Ω–∏–º—É–º 600√ó600px.</p>

            <div class="showcase-slots">
                <div class="showcase-slot" id="slot-0" onclick="triggerSlotUpload(0)">
                    <div class="slot-num">1</div>
                    <div class="slot-label">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã<br>–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    <div class="slot-overlay">
                        <button onclick="event.stopPropagation(); triggerSlotUpload(0)">–ó–∞–º–µ–Ω–∏—Ç—å</button>
                        <button class="del-btn" onclick="event.stopPropagation(); clearSlot(0)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                <div class="showcase-slot" id="slot-1" onclick="triggerSlotUpload(1)">
                    <div class="slot-num">2</div>
                    <div class="slot-label">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã<br>–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    <div class="slot-overlay">
                        <button onclick="event.stopPropagation(); triggerSlotUpload(1)">–ó–∞–º–µ–Ω–∏—Ç—å</button>
                        <button class="del-btn" onclick="event.stopPropagation(); clearSlot(1)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                <div class="showcase-slot" id="slot-2" onclick="triggerSlotUpload(2)">
                    <div class="slot-num">3</div>
                    <div class="slot-label">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã<br>–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    <div class="slot-overlay">
                        <button onclick="event.stopPropagation(); triggerSlotUpload(2)">–ó–∞–º–µ–Ω–∏—Ç—å</button>
                        <button class="del-btn" onclick="event.stopPropagation(); clearSlot(2)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <input type="file" id="slot-input-0" accept="image/*" style="display:none" onchange="loadSlotImage(0, this)">
            <input type="file" id="slot-input-1" accept="image/*" style="display:none" onchange="loadSlotImage(1, this)">
            <input type="file" id="slot-input-2" accept="image/*" style="display:none" onchange="loadSlotImage(2, this)">

            <button class="showcase-save-btn" onclick="saveShowcasePhotos()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –§–û–¢–û –ö–û–õ–õ–ï–ö–¶–ò–ò</button>
            <p class="slot-hint" style="text-align:center;">–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ —Å—Ä–∞–∑—É –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</p>
        </div>

        <!-- 3. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä -->
        <div class="card">
            <h2 class="card-title">3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                <input type="text" id="inpTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†—é–∫–∑–∞–∫ –ê–π—Ä—Ç–æ–Ω–∞">
            </div>

            <div class="form-group">
                <label>ID —Ç–æ–≤–∞—Ä–∞</label>
                <input type="text" id="inpCollection" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CF-001">
            </div>

            <div class="form-group">
                <label>–¶–µ–Ω–∞ (UZS)</label>
                <input type="number" id="inpPrice" placeholder="12516000">
            </div>

            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="inpCategory">
                    <option value="new">–ù–æ–≤–∏–Ω–∫–∏</option>
                    <option value="bags">–°—É–º–∫–∏</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                    <option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
                </select>
            </div>

            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea id="inpDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea>
            </div>

            <h3 style="margin: 30px 0 15px;">–í–∞—Ä–∏–∞–Ω—Ç—ã —Ü–≤–µ—Ç–∞ (—Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ñ–æ—Ç–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ)</h3>
            <div id="color-variants-container"></div>
            <button class="add-color-btn" onclick="addColorVariant()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Ü–≤–µ—Ç–∞</button>

            <div class="form-group" style="margin-top: 30px;">
                <label class="checkbox-label">
                    <input type="checkbox" id="inpIsNew">
                    <span>–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ "–ù–æ–≤—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è"</span>
                </label>
            </div>

            <button class="btn btn-primary" id="publishBtn" type="button" onclick="submitProduct()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ –¢–û–í–ê–†</button>
        </div>

        <!-- 4. –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="card">
            <h2 class="card-title">4. –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                <button class="btn-danger" onclick="clearAllProducts()">üóë –£–¥–∞–ª–∏—Ç—å –í–°–ï —Ç–æ–≤–∞—Ä—ã</button>
            </div>
            <div id="product-list" class="product-list"></div>
        </div>
    </div>

    <script src="database.js"></script>
    <script>
        // ‚îÄ‚îÄ SHOWCASE PHOTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let slotData = [null, null, null];

        function triggerSlotUpload(index) {
            document.getElementById(`slot-input-${index}`).click();
        }

        async function loadSlotImage(index, input) {
            if (!input.files || !input.files[0]) return;
            const compressed = await compressImage(input.files[0], 800, 0.75);
            slotData[index] = compressed;
            renderSlot(index);
            input.value = '';
        }

        function renderSlot(index) {
            const slot = document.getElementById(`slot-${index}`);
            const img = slotData[index];
            const existingImg = slot.querySelector('img.slot-photo');
            if (existingImg) existingImg.remove();
            if (img) {
                const el = document.createElement('img');
                el.src = img;
                el.className = 'slot-photo';
                slot.insertBefore(el, slot.firstChild);
                slot.querySelector('.slot-num').style.display = 'none';
                slot.querySelector('.slot-label').style.display = 'none';
            } else {
                slot.querySelector('.slot-num').style.display = '';
                slot.querySelector('.slot-label').style.display = '';
            }
        }

        function clearSlot(index) {
            slotData[index] = null;
            renderSlot(index);
        }

        function saveShowcasePhotos() {
            for (let i = 0; i < 3; i++) {
                if (slotData[i] !== null) {
                    localStorage.setItem(`defor_showcase_${i}`, slotData[i]);
                }
            }
            alert('‚úÖ –§–æ—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –û–±–Ω–æ–≤–∏—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.');
        }

        function loadSavedSlots() {
            for (let i = 0; i < 3; i++) {
                const saved = localStorage.getItem(`defor_showcase_${i}`);
                if (saved) { slotData[i] = saved; renderSlot(i); }
            }
        }

        // ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let colorVariants = [];
        let variantCounter = 0;

        document.addEventListener('DOMContentLoaded', () => {
            addColorVariant();
            refreshProductList();
            loadSavedSlots();
        });

        function compressImage(file, maxWidth = 600, quality = 0.6) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width, height = img.height;
                        if (width > maxWidth) { height = (maxWidth / width) * height; width = maxWidth; }
                        canvas.width = width; canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                };
            });
        }

        function addColorVariant() {
            if (colorVariants.length >= 5) { alert('‚ö† –ú–∞–∫—Å–∏–º—É–º 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–≤–µ—Ç–∞!'); return; }
            const variantId = variantCounter++;
            colorVariants.push({ id: variantId, colorName: '', images: [], available: true });
            renderColorVariants();
        }

        function removeColorVariant(variantId) {
            if (colorVariants.length === 1) return;
            colorVariants = colorVariants.filter(v => v.id !== variantId);
            renderColorVariants();
        }

        async function addImagesToVariant(variantId, fileInput) {
            const variant = colorVariants.find(v => v.id === variantId);
            if (!variant) return;
            for (let file of fileInput.files) {
                if (variant.images.length >= 10) break;
                variant.images.push(await compressImage(file));
            }
            fileInput.value = '';
            renderColorVariants();
        }

        function removeImageFromVariant(variantId, idx) {
            const variant = colorVariants.find(v => v.id === variantId);
            if (variant) { variant.images.splice(idx, 1); renderColorVariants(); }
        }

        function renderColorVariants() {
            document.getElementById('color-variants-container').innerHTML = colorVariants.map(v => `
                <div class="color-variant">
                    <div class="color-variant-header">
                        <div class="color-variant-title">–í–∞—Ä–∏–∞–Ω—Ç —Ü–≤–µ—Ç–∞</div>
                        ${colorVariants.length > 1 ? `<button class="remove-color-btn" onclick="removeColorVariant(${v.id})">–£–¥–∞–ª–∏—Ç—å</button>` : ''}
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞</label>
                        <input type="text" value="${v.colorName}" onchange="colorVariants.find(varnt => varnt.id === ${v.id}).colorName = this.value" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Black">
                    </div>
                    <div class="form-group">
                        <input type="file" accept="image/*" multiple onchange="addImagesToVariant(${v.id}, this)">
                        <div class="photo-queue">
                            ${v.images.map((img, idx) => `
                                <div class="queue-item">
                                    <img src="${img}">
                                    <button class="remove-btn" onclick="removeImageFromVariant(${v.id}, ${idx})">√ó</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateHero(input) {
            if (input.files && input.files[0]) {
                compressImage(input.files[0], 1200, 0.8).then(base64 => {
                    localStorage.setItem('defor_hero', base64);
                    alert('‚úì –ë–∞–Ω–Ω–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
                });
            }
        }

        function clearHero() {
            localStorage.removeItem('defor_hero');
            alert('‚úì –ë–∞–Ω–Ω–µ—Ä —É–¥–∞–ª–µ–Ω');
        }

        // ‚îÄ‚îÄ –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: ASYNC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function submitProduct() {
            const title = document.getElementById('inpTitle').value.trim();
            const price = document.getElementById('inpPrice').value.trim();
            const validVariants = colorVariants.filter(v => v.colorName && v.images.length > 0);

            if (!title || !price || validVariants.length === 0) {
                alert('‚ö† –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω—É –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ü–≤–µ—Ç —Å —Ñ–æ—Ç–æ!');
                return;
            }

            const btn = document.getElementById('publishBtn');
            btn.disabled = true;
            btn.textContent = '–ü–£–ë–õ–ò–ö–£–Æ...';

            const newProduct = {
                id: 'PROD-' + Date.now(),
                title,
                collection: document.getElementById('inpCollection').value || '',
                price: Number(price),
                category: document.getElementById('inpCategory').value,
                description: document.getElementById('inpDescription').value,
                colors: validVariants.map(v => ({ name: v.colorName, available: v.available, images: v.images })),
                images: validVariants[0].images,
                isNew: document.getElementById('inpIsNew').checked,
                createdAt: new Date().toISOString()
            };

            try {
                await addProduct(newProduct);  // ‚Üê ASYNC: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ PostgreSQL
                alert('‚úì –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!');
                location.reload();
            } catch(e) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + e.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (npm start –≤ –ø–∞–ø–∫–µ backend)');
                btn.disabled = false;
                btn.textContent = '–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ –¢–û–í–ê–†';
            }
        }

        async function refreshProductList() {
            const container = document.getElementById('product-list');
            container.innerHTML = '<p style="text-align:center;padding:20px;color:#999;">–ó–∞–≥—Ä—É–∂–∞–µ–º...</p>';
            
            try {
                const db = await getDBAsync();
                if (!db.length) {
                    container.innerHTML = '<p style="text-align:center;padding:20px;color:#999;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
                    return;
                }
                container.innerHTML = db.map(p => `
                    <div class="product-item">
                        <img src="${p.images && p.images[0] ? p.images[0] : ''}" onerror="this.style.display='none'">
                        <div class="product-details">
                            <div class="product-name">${p.title}</div>
                            <div class="product-meta">${Number(p.price).toLocaleString()} UZS ${p.collection ? '¬∑ ID: ' + p.collection : ''} ¬∑ ${p.category}</div>
                        </div>
                        <button class="btn-danger" onclick="handleDelete('${p.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `).join('');
            } catch(e) {
                container.innerHTML = `<p style="text-align:center;padding:20px;color:#e74c3c;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${e.message}</p>`;
            }
        }

        async function handleDelete(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;
            try {
                await deleteProduct(id);
                refreshProductList();
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + e.message);
            }
        }

        async function clearAllProducts() {
            if (!confirm('‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –í–°–ï –¢–û–í–ê–†–´?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            try {
                const db = await getDBAsync();
                for (const p of db) {
                    await deleteProduct(p.id);
                }
                alert('‚úÖ –í—Å–µ —Ç–æ–≤–∞—Ä—ã —É–¥–∞–ª–µ–Ω—ã');
                refreshProductList();
            } catch(e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }
    </script>
</body>
</html>